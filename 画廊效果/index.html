<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>图片轮播展示</title>
		<link rel="stylesheet" type="text/css" href="index.css"/>
		<script src="../js/jquery-1.9.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/move_new.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
		/*
		 	原理： 先把所有的li 转为绝对定位
		 		     然后在把9-20 的图片叠起来在一行不显示
		 		    之后就只要把 9-12 的图片向上走就可以了
		 		  这样等于一次性只动了12张图片,极大的提高效率
		 		  不用一次性动"几百张图片"
		 		 i/4 : 一排四张图片 0-3 就是第一行  , 这样 parseInt(i/4)求出来的就是 行
		 		 
		 */
		window.onload=function ()
		{
			//li变成绝对定位
			var oDiv=document.getElementById('div1');
			var oUl=oDiv.children[0];
			var aLi=oUl.children;
			var ready=true;
			
			var now=0;	//现在是哪张图片在第一个,让谁动
			
			for(var i=0;i<aLi.length;i++)
			{
				// 布局转换 left = 自己的  offsetLeft
				aLi[i].style.left=aLi[i].offsetLeft+'px';
				
				if(i>=12) // 大于第三排，统一给400高度 叠在一起
				{
					aLi[i].style.top='400px';
				}
				else
				{
					aLi[i].style.top=parseInt(i/4)*200+'px'; // *200 是图片的高度
				}
			}
			
			for(var i=0;i<aLi.length;i++)
			{
				aLi[i].style.position='absolute';
			}
			
			for(var i=0;i<8;i++)
			{
				aLi[i].style.filter='alpha(opacity:100)';
				aLi[i].style.opacity=1;
			}
			 
			// 从第8个开始隐藏  可以看到 ul上的样式 class="list hidden"
			for(var i=8;i<aLi.length;i++)
			{
				aLi[i].style.filter='alpha(opacity:0)';
				aLi[i].style.opacity=0;
			}
			// 去掉 hidden 溢出隐藏样式 
			oUl.className='list';
			
			//按钮
			var aBtn1=oDiv.children[1].getElementsByTagName('a');
			var aBtn2=oDiv.children[1].getElementsByTagName('span');
			
			//上一个
			aBtn1[0].onclick=aBtn2[0].onclick=function ()
			{
				// now=0 表示前8张图片,那也不能按
				if(now==0)
				{
					return;
				}
				
				if(!ready)return;
				ready=false;
				
				// now-4 表示是从移动上去的那四个图片下来(第一排的在网上一排)
				// now+8 目的是为了倒着走, 从第8张开始往下掉
				var i=now+8-1;  
				var timer=setInterval(function (){
					if(i<now)			//第一行
					{
						if(i==now-4)    
						{
							//  运动是 -200 -> 0
							startMove(aLi[i], {top: 0, opacity: 100}, function (){
								ready=true;
							});
						}
						else
						{
							startMove(aLi[i], {top: 0, opacity: 100});
						}
					}
					else if(i<now+4)	//第二行
					{
						 // 0->200
						startMove(aLi[i], {top: 200});
					}
					else			//第三行   200->400
					{
						startMove(aLi[i], {top: 400, opacity: 0});
					}
					
					i--; // 倒过来走
					if(i==now-5)   // now-4 就变成第一张图片, 第一张图片是不要动的 所以now-5
					{
						now-=4; // 倒过来走
						clearInterval(timer);
					}
				}, 40);
				
				//now+=4;
			};
			
			//下一个
			aBtn1[1].onclick=aBtn2[1].onclick=function ()
			{
				// 表示最后8张图片显示了, 就不能在点按钮了
				if(now>=aLi.length-8)
				{
					return;
				}
				
				if(!ready)return;
				ready=false;
				
				var i=now;
				var timer=setInterval(function (){
					if(i<now+4)			// +4 前4张   <4 就是0-3个 ：第一行
					{
						// 往上走就是-200px  第一行 运动 0->-200
						startMove(aLi[i], {top: -200, opacity: 0});
					}
					else if(i<now+8)	 // +8 前8张    4-7个
					{
						//第二行  运动 200->0 
						startMove(aLi[i], {top: 0});
					}
					else			//第三行  运动 400->200
					{
						if(i==now+11)
						{
							startMove(aLi[i], {top: 200, opacity: 100}, function (){
								ready=true;
							});
						}
						else
						{
							startMove(aLi[i], {top: 200, opacity: 100});
						}
					}
					
					i++;
					// 12张 到头了 
					if(i==now+12)
					{
						now+=4; // 关闭定时器才加4 表示一次已经循环完成
						clearInterval(timer);
					}
				}, 40);
				
			};
		};
		</script>
	</head>
	<body>
		<div class="imgListBox" id="div1">
			<ul class="list hidden">
		    	<li><a href="javascript:void(0);"><img src="img/02.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/03.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/04.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/05.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/06.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/07.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/08.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/09.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/10.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/11.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/12.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/13.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/14.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/15.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/16.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/17.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/18.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/19.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/20.jpg" alt="" /></a></li>
				<li><a href="javascript:void(0);"><img src="img/01.jpg" alt="" /></a></li>
			</ul>
		    <div class="page">
		    	<a href="javascript:void(0);" class="prev"></a>
		    	<a href="javascript:void(0);" class="next"></a>
		    	<span class="prev_ie6"></span>
		        <span class="next_ie6"></span>
		    </div>
		</div>
	</body>
</html>
